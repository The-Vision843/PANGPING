<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ping Pong — Advanced Controls</title>
  <style>
    :root {
      --bg: #0f1724;
      --accent: #06b6d4;
      --muted: #94a3b8;
      --paddle: #e6eef6;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: linear-gradient(180deg, var(--bg), #071023 80%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-family: system-ui, sans-serif;
    }
    canvas {
      background: #0a1328;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
    .hud {
      position: fixed;
      top: 10px;
      left: 0;
      right: 0;
      text-align: center;
      color: #e6eef6;
      font-weight: bold;
    }
    button {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="hud">W/S/A/D = Player 1 | ↑/↓/←/→ = Player 2 (or AI) | Space = Pause | M = Toggle AI</div>
  <canvas id="game" width="900" height="450"></canvas>
  <button id="toggleAI">Switch to AI Mode</button>
  <audio id="bgm" loop autoplay>
    <source src="https://cdn.pixabay.com/download/audio/2022/10/24/audio_8d6b6b60b1.mp3?filename=moonlight-sonata-beethoven-15007.mp3" type="audio/mpeg">
  </audio>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const toggleBtn = document.getElementById('toggleAI');

    const W = canvas.width, H = canvas.height;
    const left = {x: 20, y: H/2-40, w: 10, h: 80, dy: 0, dx: 0};
    const right = {x: W-30, y: H/2-40, w: 10, h: 80, dy: 0, dx: 0};
    const ball = {x: W/2, y: H/2, r: 8, vx: 5, vy: 3, speed: 5};

    let leftScore = 0, rightScore = 0, paused = true, aiMode = false;

    function resetBall(direction = 1) {
      ball.x = W / 2;
      ball.y = H / 2;
      ball.speed = 5;
      ball.vx = ball.speed * direction;
      ball.vy = (Math.random() * 4 - 2);
    }

    function drawRect(x, y, w, h, c) { ctx.fillStyle = c; ctx.fillRect(x, y, w, h); }
    function drawCircle(x, y, r, c) { ctx.beginPath(); ctx.fillStyle = c; ctx.arc(x, y, r, 0, Math.PI * 2); ctx.fill(); }
    function drawText(t, x, y) { ctx.fillStyle = '#e6eef6'; ctx.font = '20px system-ui'; ctx.fillText(t, x, y); }

    function update() {
      if (paused) return;

      ball.x += ball.vx;
      ball.y += ball.vy;

      // Wall bounce
      if (ball.y - ball.r < 0 || ball.y + ball.r > H) ball.vy *= -1;

      // Left paddle
      if (ball.x - ball.r < left.x + left.w && ball.y > left.y && ball.y < left.y + left.h) {
        let power = 1 + (left.dx > 0 ? 0.5 : left.dx < 0 ? -0.3 : 0);
        ball.vx = Math.abs(ball.vx) * power;
        ball.vx = Math.min(ball.vx, 12);
        ball.vx *= 1;
        ball.x = left.x + left.w + ball.r;
        ball.vy += left.dy * 0.2;
      }

      // Right paddle
      if (ball.x + ball.r > right.x && ball.y > right.y && ball.y < right.y + right.h) {
        let power = 1 + (right.dx < 0 ? 0.5 : right.dx > 0 ? -0.3 : 0);
        ball.vx = -Math.abs(ball.vx) * power;
        ball.vx = Math.max(ball.vx, -12);
        ball.x = right.x - ball.r;
        ball.vy += right.dy * 0.2;
      }

      // Score
      if (ball.x < 0) { rightScore++; resetBall(1); paused = true; }
      if (ball.x > W) { leftScore++; resetBall(-1); paused = true; }

      // AI behavior
      if (aiMode) {
        const target = ball.y - (right.h / 2);
        if (right.y + right.h / 2 < ball.y) right.y += 4;
        else right.y -= 4;
        right.y = Math.max(0, Math.min(H - right.h, right.y));
      } else {
        right.y += right.dy;
        right.x += right.dx;
      }

      left.y += left.dy;
      left.x += left.dx;

      left.y = Math.max(0, Math.min(H - left.h, left.y));
      right.y = Math.max(0, Math.min(H - right.h, right.y));
      left.x = Math.max(0, Math.min(W/2 - left.w - 20, left.x));
      right.x = Math.max(W/2 + 10, Math.min(W - right.w, right.x));
    }

    function draw() {
      ctx.clearRect(0, 0, W, H);
      drawRect(0, 0, W, H, '#0a1328');

      drawRect(W/2 - 2, 0, 4, H, 'rgba(255,255,255,0.2)');
      drawRect(left.x, left.y, left.w, left.h, '#e6eef6');
      drawRect(right.x, right.y, right.w, right.h, '#e6eef6');
      drawCircle(ball.x, ball.y, ball.r, '#06b6d4');

      drawText(leftScore, W/2 - 50, 30);
      drawText(rightScore, W/2 + 30, 30);

      if (paused) {
        drawText('Press SPACE to start', W/2 - 110, H/2);
      }
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    const keys = {};
    window.addEventListener('keydown', e => {
      keys[e.key.toLowerCase()] = true;
      if (e.key === ' ') paused = !paused;
      if (e.key.toLowerCase() === 'm') toggleAI();
    });
    window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    function handleControls() {
      // Player 1 (W/S/A/D)
      left.dy = keys['w'] ? -6 : keys['s'] ? 6 : 0;
      left.dx = keys['a'] ? -3 : keys['d'] ? 3 : 0;

      // Player 2 (↑/↓/←/→)
      if (!aiMode) {
        right.dy = keys['arrowup'] ? -6 : keys['arrowdown'] ? 6 : 0;
        right.dx = keys['arrowleft'] ? -3 : keys['arrowright'] ? 3 : 0;
      }
    }

    function toggleAI() {
      aiMode = !aiMode;
      toggleBtn.textContent = aiMode ? 'Switch to 2 Player Mode' : 'Switch to AI Mode';
    }

    toggleBtn.onclick = toggleAI;
    setInterval(handleControls, 1000 / 60);

    resetBall();
    loop();
  </script>
</body>
</html>
